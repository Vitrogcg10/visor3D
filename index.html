
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Archivo vinculado desde lista SharePoint</title>
<style>
    body { font-family: Arial; margin: 20px; }
    .info { font-size: 18px; margin-bottom: 10px; }
    img { max-width: 500px; margin-top: 20px; }
</style>
</head>
<body>
<h1>Archivo vinculado</h1>
<p id="status">Cargando información...</p>
<div id="viewer"></div>

<script>
async function obtenerArchivoDesdeSharePoint() {
    const params = new URLSearchParams(window.location.search);
    const proyecto = params.get('proyecto'); // Ej: PlantaPrueba/ProyectoPrueba

    if (!proyecto) {
        document.getElementById('status').textContent = "No se especificó el proyecto.";
        return;
    }

    try {
        // URL de la lista en SharePoint (ajusta con tu sitio y lista)
        const listaURL = `https://vitroonline.sharepoint.com/sites/EngineeringVault/_api/web/lists/getbytitle('Proyectos')/items?$filter=Proyecto eq '${proyecto}'`;

        const response = await fetch(listaURL, {
            headers: {
                "Accept": "application/json;odata=verbose"
            },
            credentials: "include" // Usa la sesión actual del usuario
        });

        const data = await response.json();
        if (!data.d || data.d.results.length === 0) {
            document.getElementById('status').textContent = "No se encontró información para el proyecto.";
            return;
        }

        const archivoURL = data.d.results[0].ArchivoURL;
        document.getElementById('status').textContent = "Archivo encontrado: " + archivoURL;

        const viewer = document.getElementById('viewer');
        if (archivoURL.endsWith(".jpg") || archivoURL.endsWith(".png")) {
            const img = document.createElement('img');
            img.src = archivoURL;
            viewer.appendChild(img);
        } else {
            const link = document.createElement('a');
            link.href = archivoURL;
            link.textContent = "Abrir archivo";
            link.target = "_blank";
            viewer.appendChild(link);
        }

    } catch (error) {
        document.getElementById('status').textContent = "Error al obtener datos: " + error;
    }
}

obtenerArchivoDesdeSharePoint();
</script>
</body>
</html>
